============================= test session starts ==============================
platform linux -- Python 3.12.11, pytest-8.4.2, pluggy-1.6.0
cachedir: .cache/pytest
rootdir: /app
configfile: setup.cfg
testpaths: tests
plugins: rerunfailures-16.0.1, xonsh-0.19.9, timeout-2.4.0, cov-6.2.1, subprocess-1.5.3, mock-3.15.0
timeout: 240.0s
timeout method: signal
timeout func_only: False
collected 5185 items

tests/api/test_os.xsh ..                                                 [  0%]
tests/api/test_subprocess.xsh ....                                       [  0%]
tests/test_xonsh.xsh ...                                                 [  0%]
tests/aliases/test_completer_alias.py .......                            [  0%]
tests/aliases/test_source.py ....                                        [  0%]
tests/aliases/test_xexec.py .......                                      [  0%]
tests/built_ins/test_tracer.py ..                                        [  0%]
tests/built_ins/test_wizard.py ....                                      [  0%]
tests/built_ins/test_xonfig.py ..........                                [  0%]
tests/built_ins/test_xontribs.py ........                                [  0%]
tests/completers/test_base_completer.py ..                               [  1%]
tests/completers/test_bash_completer.py FFFFFFFFFFFFFFFFFFF.             [  1%]
tests/completers/test_command_completers.py .....                        [  1%]
tests/completers/test_completer_command.py ......                        [  1%]
tests/completers/test_dir_completers.py .........                        [  1%]
tests/completers/test_environment_completer.py .....                     [  1%]
tests/completers/test_gh.py ss                                           [  1%]
tests/completers/test_path_completers.py ...............                 [  2%]
tests/completers/test_pip_completer.py ...............                   [  2%]
tests/completers/test_python.py .........................                [  2%]
tests/completers/test_xompletions.py .....                               [  3%]
tests/history/test_history_dummy.py ......                               [  3%]
tests/history/test_history_json.py ..................................... [  3%]
...............                                                          [  4%]
tests/history/test_history_sqlite.py ......................              [  4%]
tests/lib/test_collections.py ..............                             [  4%]
tests/lib/test_itertools.py ...                                          [  4%]
tests/lib/test_jsonutils.py .......                                      [  5%]
tests/lib/test_lazyasd.py .                                              [  5%]
tests/lib/test_lazyjson.py ...................                           [  5%]
tests/lib/test_pretty.py ...........                                     [  5%]
tests/parsers/test_ast.py ............................                   [  6%]
tests/parsers/test_lexer.py ............................................ [  7%]
.................................................                        [  8%]
tests/parsers/test_parser.py ...........................xxxxxxxxxxxxxx.. [  8%]
.......................................................x................ [ 10%]
........................................................................ [ 11%]
........................................................................ [ 13%]
........................................................................ [ 14%]
........................................................................ [ 15%]
........................................................................ [ 17%]
........................................................................ [ 18%]
........................................................................ [ 19%]
........................................................................ [ 21%]
........................................................................ [ 22%]
........................................................................ [ 24%]
........................................................................ [ 25%]
........................................................................ [ 26%]
........................................................................ [ 28%]
........................................................................ [ 29%]
........................................................................ [ 31%]
........................................................................ [ 32%]
........................................................................ [ 33%]
........................................................................ [ 35%]
........................................................................ [ 36%]
........................................................................ [ 38%]
........................................................................ [ 39%]
........................................................................ [ 40%]
........................................................................ [ 42%]
........................................................................ [ 43%]
........................................................................ [ 44%]
........................................................................ [ 46%]
........................................................................ [ 47%]
........................................................................ [ 49%]
........................................................................ [ 50%]
..                                                                       [ 50%]
tests/platform/test_platform.py F.                                       [ 50%]
tests/procs/test_executables.py ....                                     [ 50%]
tests/procs/test_jobs.py ..                                              [ 50%]
tests/procs/test_pipelines.py ssssssssssssssssssssssssss                 [ 51%]
tests/procs/test_specs.py ssssssssssssssssssssssssssssssssssssssssssssss [ 52%]
ssssssssssssssssssssssssssss                                             [ 52%]
tests/prompt/test_base.py .............................................. [ 53%]
.....x....                                                               [ 53%]
tests/prompt/test_cwd.py .                                               [ 53%]
tests/prompt/test_gitstatus.py ....                                      [ 53%]
tests/prompt/test_job.py .                                               [ 53%]
tests/prompt/test_vc.py .ss..ss.ss..                                     [ 54%]
tests/shell/test_base_shell.py .....                                     [ 54%]
tests/shell/test_ptk_completer.py ..................                     [ 54%]
tests/shell/test_ptk_highlight.py .......................                [ 54%]
tests/shell/test_ptk_history.py .                                        [ 54%]
tests/shell/test_ptk_multiline.py .......                                [ 55%]
tests/shell/test_ptk_shell.py ....................                       [ 55%]
tests/shell/test_readline_shell.py ............                          [ 55%]
tests/shell/test_shell.py ...                                            [ 55%]
tests/test_aliases.py ..............................                     [ 56%]
tests/test_ansi_colors.py .............................................. [ 57%]
........................................................................ [ 58%]
........................................................................ [ 60%]
........................................................................ [ 61%]
........................................................................ [ 62%]
........................................................................ [ 64%]
........................................................................ [ 65%]
........................................................................ [ 66%]
........................................................................ [ 68%]
........................................................................ [ 69%]
.................                                                        [ 70%]
tests/test_builtins.py sF............................................... [ 71%]
........................................                                 [ 71%]
tests/test_cli_utils.py ....                                             [ 71%]
tests/test_color_tools.py ............................                   [ 72%]
tests/test_commands_cache.py ........................................... [ 73%]
.......                                                                  [ 73%]
tests/test_completer.py ..........                                       [ 73%]
tests/test_completion_context.py ....................................... [ 74%]
........................................................................ [ 75%]
........................................................................ [ 77%]
........................................................................ [ 78%]
........................................................................ [ 79%]
.................................................                        [ 80%]
tests/test_contexts.py .........................                         [ 81%]
tests/test_dirstack.py ........                                          [ 81%]
tests/test_dirstack_unc.py ..ssssssss                                    [ 81%]
tests/test_environ.py ...................s.............................. [ 82%]
...................                                                      [ 82%]
tests/test_events.py ..........                                          [ 83%]
tests/test_execer.py ss................................                  [ 83%]
tests/test_foreign_shells.py .....s                                      [ 83%]
tests/test_imphooks.py ........                                          [ 84%]
tests/test_integrations.py .............................s...x........... [ 84%]
....X............................sss...................RRRFRRRFFFF...... [ 86%]
...........                                                              [ 86%]
tests/test_main.py ..................................................... [ 87%]
..................                                                       [ 87%]
tests/test_man.py FFs                                                    [ 87%]
tests/test_pyghooks.py ................................................. [ 88%]
..................................                                       [ 89%]
tests/test_tools.py .................................................... [ 90%]
........................................................................ [ 91%]
........................................................................ [ 93%]
........................................................................ [ 94%]
........................................................................ [ 96%]
........................................................................ [ 97%]
........................................................................ [ 98%]
..............................................                           [ 99%]
tests/test_virtualenv_activator.py ..                                    [ 99%]
tests/xoreutils/test_cat.py ........                                     [ 99%]
tests/xoreutils/test_uname.py .                                          [ 99%]
tests/xoreutils/test_uptime.py .                                         [ 99%]
tests/xoreutils/test_which.py ....                                       [100%]

=================================== FAILURES ===================================
_____________ test_bash_completer[command_context0-completions0-5] _____________

command_context = CommandContext(args=(CommandArg(value='bash', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='--deb', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'--debug', '--debugger'}, lprefix = 5

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            (
                CommandContext(args=(CommandArg("bash"),), arg_index=1, prefix="--deb"),
                {"--debug", "--debugger"},
                5,
            ),
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix=""),
                {"'testdir/'", "'spaced dir/'"},
                0,
            ),
            # tar replaces "~/" with "/home/user/", the change should be rolledback by us.
            (
                CommandContext(args=(CommandArg("tar"),), arg_index=1, prefix="~/"),
                {"~/c", "~/u", "~/t", "~/d", "~/A", "~/r", "~/x"},
                2,
            ),
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="", opening_quote="'"
                ),
                {"'testdir/'", "'spaced dir/'"},
                1,
            ),
        ),
    )
    def test_bash_completer(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'--debug', '--debugger'}
E
E         Extra items in the right set:
E         '--debugger'
E         '--debug'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:61: AssertionError
_____________ test_bash_completer[command_context1-completions1-0] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {"'spaced dir/'", "'testdir/'"}, lprefix = 0

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            (
                CommandContext(args=(CommandArg("bash"),), arg_index=1, prefix="--deb"),
                {"--debug", "--debugger"},
                5,
            ),
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix=""),
                {"'testdir/'", "'spaced dir/'"},
                0,
            ),
            # tar replaces "~/" with "/home/user/", the change should be rolledback by us.
            (
                CommandContext(args=(CommandArg("tar"),), arg_index=1, prefix="~/"),
                {"~/c", "~/u", "~/t", "~/d", "~/A", "~/r", "~/x"},
                2,
            ),
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="", opening_quote="'"
                ),
                {"'testdir/'", "'spaced dir/'"},
                1,
            ),
        ),
    )
    def test_bash_completer(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'spaced dir... "'testdir/'"}
E
E         Extra items in the right set:
E         "'spaced dir/'"
E         "'testdir/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:61: AssertionError
_____________ test_bash_completer[command_context2-completions2-2] _____________

command_context = CommandContext(args=(CommandArg(value='tar', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='~/', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'~/A', '~/c', '~/d', '~/r', '~/t', '~/u', ...}, lprefix = 2

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            (
                CommandContext(args=(CommandArg("bash"),), arg_index=1, prefix="--deb"),
                {"--debug", "--debugger"},
                5,
            ),
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix=""),
                {"'testdir/'", "'spaced dir/'"},
                0,
            ),
            # tar replaces "~/" with "/home/user/", the change should be rolledback by us.
            (
                CommandContext(args=(CommandArg("tar"),), arg_index=1, prefix="~/"),
                {"~/c", "~/u", "~/t", "~/d", "~/A", "~/r", "~/x"},
                2,
            ),
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="", opening_quote="'"
                ),
                {"'testdir/'", "'spaced dir/'"},
                1,
            ),
        ),
    )
    def test_bash_completer(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'~/A', '~/c'...', '~/u', ...}
E
E         Extra items in the right set:
E         '~/c'
E         '~/A'
E         '~/t'
E         '~/u'
E         '~/d'...
E
E         ...Full output truncated (3 lines hidden), use '-vv' to show)

/app/tests/completers/test_bash_completer.py:61: AssertionError
_____________ test_bash_completer[command_context3-completions3-1] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='', suffix='', opening_quote="'", closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {"'spaced dir/'", "'testdir/'"}, lprefix = 1

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            (
                CommandContext(args=(CommandArg("bash"),), arg_index=1, prefix="--deb"),
                {"--debug", "--debugger"},
                5,
            ),
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix=""),
                {"'testdir/'", "'spaced dir/'"},
                0,
            ),
            # tar replaces "~/" with "/home/user/", the change should be rolledback by us.
            (
                CommandContext(args=(CommandArg("tar"),), arg_index=1, prefix="~/"),
                {"~/c", "~/u", "~/t", "~/d", "~/A", "~/r", "~/x"},
                2,
            ),
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="", opening_quote="'"
                ),
                {"'testdir/'", "'spaced dir/'"},
                1,
            ),
        ),
    )
    def test_bash_completer(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'spaced dir... "'testdir/'"}
E
E         Extra items in the right set:
E         "'spaced dir/'"
E         "'testdir/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:61: AssertionError
_____________ test_quote_handling[command_context0-completions0-4] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='/pro', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'/proc/'}, lprefix = 4

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'/proc/'}
E
E         Extra items in the right set:
E         '/proc/'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context1-completions1-5] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='/pro', suffix='', opening_quote="'", closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {"'/proc/'"}, lprefix = 5

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'/proc/'"}
E
E         Extra items in the right set:
E         "'/proc/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context2-completions2-5] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='/pro', suffix='', opening_quote="'", closing_quote="'", is_after_closing_quote=False, subcmd_opening='')
completions = {"'/proc/"}, lprefix = 5

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'/proc/"}
E
E         Extra items in the right set:
E         "'/proc/"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context3-completions3-6] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='/pro', suffix='', opening_quote="'", closing_quote="'", is_after_closing_quote=True, subcmd_opening='')
completions = {"'/proc/'"}, lprefix = 6

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'/proc/'"}
E
E         Extra items in the right set:
E         "'/proc/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
____________ test_quote_handling[command_context4-completions4-10] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='/pro', suffix='', opening_quote='"""', closing_quote='"""', is_after_closing_quote=True, subcmd_opening='')
completions = {'"""/proc/"""'}, lprefix = 10

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {'"""/proc/"""'}
E
E         Extra items in the right set:
E         '"""/proc/"""'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context5-completions5-4] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='./sp', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {"'./spaced dir/'"}, lprefix = 4

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'./spaced dir/'"}
E
E         Extra items in the right set:
E         "'./spaced dir/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context6-completions6-5] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='./sp', suffix='', opening_quote="'", closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {"'./spaced dir/'"}, lprefix = 5

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'./spaced dir/'"}
E
E         Extra items in the right set:
E         "'./spaced dir/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context7-completions7-5] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='./sp', suffix='', opening_quote="'", closing_quote="'", is_after_closing_quote=False, subcmd_opening='')
completions = {"'./spaced dir/"}, lprefix = 5

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'./spaced dir/"}
E
E         Extra items in the right set:
E         "'./spaced dir/"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_____________ test_quote_handling[command_context8-completions8-6] _____________

command_context = CommandContext(args=(CommandArg(value='ls', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='./sp', suffix='', opening_quote="'", closing_quote="'", is_after_closing_quote=True, subcmd_opening='')
completions = {"'./spaced dir/'"}, lprefix = 6

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix",
        (
            # ls /pro<TAB>  ->  ls /proc/
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="/pro"),
                {"/proc/"},
                4,
            ),
            # ls '/pro<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="/pro", opening_quote="'"
                ),
                {"'/proc/'"},
                5,
            ),
            # ls '/pro<TAB>'  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'/proc/"},
                5,
            ),
            # ls '/pro'<TAB>  ->  ls '/proc/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'/proc/'"},
                6,
            ),
            # ls """/pro"""<TAB>  ->  ls """/proc/"""
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="/pro",
                    opening_quote='"""',
                    closing_quote='"""',
                    is_after_closing_quote=True,
                ),
                {'"""/proc/"""'},
                10,
            ),
            # Completions that have to be quoted:
            # ls ./sp  ->  ls './spaced dir/'
            (
                CommandContext(args=(CommandArg("ls"),), arg_index=1, prefix="./sp"),
                {"'./spaced dir/'"},
                4,
            ),
            # ls './sp<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),), arg_index=1, prefix="./sp", opening_quote="'"
                ),
                {"'./spaced dir/'"},
                5,
            ),
            # ls './sp<TAB>'  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                ),
                {"'./spaced dir/"},
                5,
            ),
            # ls './sp'<TAB>  ->  ls './spaced dir/'
            (
                CommandContext(
                    args=(CommandArg("ls"),),
                    arg_index=1,
                    prefix="./sp",
                    opening_quote="'",
                    closing_quote="'",
                    is_after_closing_quote=True,
                ),
                {"'./spaced dir/'"},
                6,
            ),
        ),
    )
    def test_quote_handling(command_context, completions, lprefix):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       assert (set() == {"'./spaced dir/'"}
E
E         Extra items in the right set:
E         "'./spaced dir/'"
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:167: AssertionError
_______________________ test_bash_completer_empty_prefix _______________________

    @skip_if_on_darwin
    @skip_if_on_windows
    def test_bash_completer_empty_prefix():
        context = CompletionContext(
            CommandContext(args=(CommandArg("git"),), arg_index=1, prefix="")
        )
        bash_completions, bash_lprefix = complete_from_bash(context)
>       assert {"clean", "show"}.issubset(bash_completions)
E       AssertionError: assert False
E        +  where False = <built-in method issubset of set object at 0x7f8ea0084200>(set())
E        +    where <built-in method issubset of set object at 0x7f8ea0084200> = {'clean', 'show'}.issubset

/app/tests/completers/test_bash_completer.py:181: AssertionError
__________ test_equal_sign_arg[command_context0-completions0-3-False] __________

command_context = CommandContext(args=(CommandArg(value='dd', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='sta', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'status='}, lprefix = 3, exp_append_space = False

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix, exp_append_space",
        (
            # dd sta  ->  dd status=
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="sta"),
                {"status="},
                3,
                False,
            ),
            # date --u  ->  date --utc
            (
                CommandContext(args=(CommandArg("date"),), arg_index=1, prefix="--u"),
                {"--utc"},
                3,
                True,
            ),
            # dd status=pr -> dd status=progress
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="status=pr"),
                {"progress"},
                2,
                True,
            ),
            # dd if=/et -> dd if=/etc/
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="if=/et"),
                {"/etc/"},
                3,
                False,
            ),
            # dd of=/dev/nul -> dd of=/dev/null
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="of=/dev/nul"),
                {"/dev/null"},
                8,
                True,
            ),
        ),
    )
    def test_equal_sign_arg(command_context, completions, lprefix, exp_append_space):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'status='}
E
E         Extra items in the right set:
E         'status='
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:230: AssertionError
__________ test_equal_sign_arg[command_context1-completions1-3-True] ___________

command_context = CommandContext(args=(CommandArg(value='date', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='--u', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'--utc'}, lprefix = 3, exp_append_space = True

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix, exp_append_space",
        (
            # dd sta  ->  dd status=
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="sta"),
                {"status="},
                3,
                False,
            ),
            # date --u  ->  date --utc
            (
                CommandContext(args=(CommandArg("date"),), arg_index=1, prefix="--u"),
                {"--utc"},
                3,
                True,
            ),
            # dd status=pr -> dd status=progress
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="status=pr"),
                {"progress"},
                2,
                True,
            ),
            # dd if=/et -> dd if=/etc/
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="if=/et"),
                {"/etc/"},
                3,
                False,
            ),
            # dd of=/dev/nul -> dd of=/dev/null
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="of=/dev/nul"),
                {"/dev/null"},
                8,
                True,
            ),
        ),
    )
    def test_equal_sign_arg(command_context, completions, lprefix, exp_append_space):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'--utc'}
E
E         Extra items in the right set:
E         '--utc'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:230: AssertionError
__________ test_equal_sign_arg[command_context2-completions2-2-True] ___________

command_context = CommandContext(args=(CommandArg(value='dd', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='status=pr', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'progress'}, lprefix = 2, exp_append_space = True

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix, exp_append_space",
        (
            # dd sta  ->  dd status=
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="sta"),
                {"status="},
                3,
                False,
            ),
            # date --u  ->  date --utc
            (
                CommandContext(args=(CommandArg("date"),), arg_index=1, prefix="--u"),
                {"--utc"},
                3,
                True,
            ),
            # dd status=pr -> dd status=progress
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="status=pr"),
                {"progress"},
                2,
                True,
            ),
            # dd if=/et -> dd if=/etc/
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="if=/et"),
                {"/etc/"},
                3,
                False,
            ),
            # dd of=/dev/nul -> dd of=/dev/null
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="of=/dev/nul"),
                {"/dev/null"},
                8,
                True,
            ),
        ),
    )
    def test_equal_sign_arg(command_context, completions, lprefix, exp_append_space):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'progress'}
E
E         Extra items in the right set:
E         'progress'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:230: AssertionError
__________ test_equal_sign_arg[command_context3-completions3-3-False] __________

command_context = CommandContext(args=(CommandArg(value='dd', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='if=/et', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'/etc/'}, lprefix = 3, exp_append_space = False

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix, exp_append_space",
        (
            # dd sta  ->  dd status=
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="sta"),
                {"status="},
                3,
                False,
            ),
            # date --u  ->  date --utc
            (
                CommandContext(args=(CommandArg("date"),), arg_index=1, prefix="--u"),
                {"--utc"},
                3,
                True,
            ),
            # dd status=pr -> dd status=progress
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="status=pr"),
                {"progress"},
                2,
                True,
            ),
            # dd if=/et -> dd if=/etc/
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="if=/et"),
                {"/etc/"},
                3,
                False,
            ),
            # dd of=/dev/nul -> dd of=/dev/null
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="of=/dev/nul"),
                {"/dev/null"},
                8,
                True,
            ),
        ),
    )
    def test_equal_sign_arg(command_context, completions, lprefix, exp_append_space):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'/etc/'}
E
E         Extra items in the right set:
E         '/etc/'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:230: AssertionError
__________ test_equal_sign_arg[command_context4-completions4-8-True] ___________

command_context = CommandContext(args=(CommandArg(value='dd', opening_quote='', closing_quote='', is_io_redir=False),), arg_index=1, prefix='of=/dev/nul', suffix='', opening_quote='', closing_quote='', is_after_closing_quote=False, subcmd_opening='')
completions = {'/dev/null'}, lprefix = 8, exp_append_space = True

    @skip_if_on_darwin
    @skip_if_on_windows
    @pytest.mark.parametrize(
        "command_context, completions, lprefix, exp_append_space",
        (
            # dd sta  ->  dd status=
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="sta"),
                {"status="},
                3,
                False,
            ),
            # date --u  ->  date --utc
            (
                CommandContext(args=(CommandArg("date"),), arg_index=1, prefix="--u"),
                {"--utc"},
                3,
                True,
            ),
            # dd status=pr -> dd status=progress
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="status=pr"),
                {"progress"},
                2,
                True,
            ),
            # dd if=/et -> dd if=/etc/
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="if=/et"),
                {"/etc/"},
                3,
                False,
            ),
            # dd of=/dev/nul -> dd of=/dev/null
            (
                CommandContext(args=(CommandArg("dd"),), arg_index=1, prefix="of=/dev/nul"),
                {"/dev/null"},
                8,
                True,
            ),
        ),
    )
    def test_equal_sign_arg(command_context, completions, lprefix, exp_append_space):
        bash_completions, bash_lprefix = complete_from_bash(
            CompletionContext(command_context)
        )
>       assert bash_completions == completions and bash_lprefix == lprefix
E       AssertionError: assert (set() == {'/dev/null'}
E
E         Extra items in the right set:
E         '/dev/null'
E         Use -v to get more diff)

/app/tests/completers/test_bash_completer.py:230: AssertionError
___________________________ test_githash_value_error ___________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f8e9a267a10>

    def test_githash_value_error(monkeypatch):
        @contextmanager
        def mocked_open(*args):
            yield MagicMock(read=lambda: "abc123")

        monkeypatch.setattr(builtins, "open", mocked_open)
        sha, date_ = xp.githash()
>       assert date_ is None
E       AssertionError: assert 'Aug 11 05:55:58 2025' is None

tests/platform/test_platform.py:15: AssertionError
____________________________ test_repath_backslash _____________________________

home_env = <xonsh.built_ins.XonshSession object at 0x7f8ea44fad20>

    @skip_if_on_windows
    def test_repath_backslash(home_env):
        exp = os.listdir(HOME_PATH)
        exp = {p for p in exp if re.match(r"\w\w.*", p)}
        exp = {os.path.join(HOME_PATH, p) for p in exp}
        obs = set(pathsearch(regexsearch, r"~/\w\w.*"))
>       assert exp == obs
E       AssertionError: assert set() == {'~/\\w\\w.*'}
E
E         Extra items in the right set:
E         '~/\\w\\w.*'
E         Use -v to get more diff

/app/tests/test_builtins.py:56: AssertionError
__________________________ test_catching_system_exit ___________________________

    @pytest.mark.flaky(reruns=3, reruns_delay=1)
    def test_catching_system_exit():
        stdin_cmd = "__import__('sys').exit(2)\n"
>       out, err, ret = run_xonsh(
            cmd=None, stdin_cmd=stdin_cmd, interactive=True, single_command=False, timeout=3
        )

tests/test_integrations.py:1347:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests/test_integrations.py:115: in run_xonsh
    out, err = proc.communicate(input=input, timeout=timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/subprocess.py:1209: in communicate
    stdout, stderr = self._communicate(input, endtime, timeout)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/subprocess.py:2116: in _communicate
    self._check_timeout(endtime, orig_timeout, stdout, stderr)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <Popen: returncode: None args: ['/app/venv/bin/xonsh', '--no-rc', '-i']>
endtime = 20359040.48456806, orig_timeout = 3, stdout_seq = []
stderr_seq = None, skip_check_and_raise = False

    def _check_timeout(self, endtime, orig_timeout, stdout_seq, stderr_seq,
                       skip_check_and_raise=False):
        """Convenience for checking if a timeout has expired."""
        if endtime is None:
            return
        if skip_check_and_raise or _time() > endtime:
>           raise TimeoutExpired(
                    self.args, orig_timeout,
                    output=b''.join(stdout_seq) if stdout_seq else None,
                    stderr=b''.join(stderr_seq) if stderr_seq else None)
E           subprocess.TimeoutExpired: Command '['/app/venv/bin/xonsh', '--no-rc', '-i']' timed out after 3 seconds

/usr/lib/python3.12/subprocess.py:1253: TimeoutExpired
__________________________ test_catching_exit_signal ___________________________

    @skip_if_on_windows
    @pytest.mark.flaky(reruns=3, reruns_delay=1)
    def test_catching_exit_signal():
        stdin_cmd = "sleep 0.2; kill -SIGHUP @(__import__('os').getpid())\n"
>       out, err, ret = run_xonsh(
            cmd=None, stdin_cmd=stdin_cmd, interactive=True, single_command=False, timeout=3
        )

tests/test_integrations.py:1357:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests/test_integrations.py:115: in run_xonsh
    out, err = proc.communicate(input=input, timeout=timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/subprocess.py:1209: in communicate
    stdout, stderr = self._communicate(input, endtime, timeout)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/subprocess.py:2116: in _communicate
    self._check_timeout(endtime, orig_timeout, stdout, stderr)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <Popen: returncode: None args: ['/app/venv/bin/xonsh', '--no-rc', '-i']>
endtime = 20359056.46087776, orig_timeout = 3, stdout_seq = []
stderr_seq = None, skip_check_and_raise = False

    def _check_timeout(self, endtime, orig_timeout, stdout_seq, stderr_seq,
                       skip_check_and_raise=False):
        """Convenience for checking if a timeout has expired."""
        if endtime is None:
            return
        if skip_check_and_raise or _time() > endtime:
>           raise TimeoutExpired(
                    self.args, orig_timeout,
                    output=b''.join(stdout_seq) if stdout_seq else None,
                    stderr=b''.join(stderr_seq) if stderr_seq else None)
E           subprocess.TimeoutExpired: Command '['/app/venv/bin/xonsh', '--no-rc', '-i']' timed out after 3 seconds

/usr/lib/python3.12/subprocess.py:1253: TimeoutExpired
____________________________ test_forwarding_sighup ____________________________

tmpdir = local('/tmp/pytest-of-root/pytest-0/test_forwarding_sighup0')

    @skip_if_on_windows
    def test_forwarding_sighup(tmpdir):
        """We want to make sure that SIGHUP is forwarded to subprocesses when
        received, so we spin up a Bash process that waits for SIGHUP and then
        writes `SIGHUP` to a file, then exits. Then we check the content of
        that file to ensure that the Bash process really did get SIGHUP."""
        outfile = tmpdir.mkdir("xonsh_test_dir").join("sighup_test.out")

        stdin_cmd = f"""
    sleep 0.2
    (sleep 1 && kill -SIGHUP @(__import__('os').getppid())) &
    bash -c "trap 'echo SIGHUP > {outfile}; exit 0' HUP; sleep 30 & wait $!"
    """
        proc = run_xonsh(
            cmd=None,
            stdin_cmd=stdin_cmd,
            stderr=sp.PIPE,
            interactive=True,
            single_command=False,
            blocking=False,
        )
>       proc.wait(timeout=5)

tests/test_integrations.py:1384:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python3.12/subprocess.py:1264: in wait
    return self._wait(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <Popen: returncode: None args: ['/app/venv/bin/xonsh', '--no-rc', '-i']>
timeout = 5

    def _wait(self, timeout):
        """Internal implementation of wait() on POSIX."""
        if self.returncode is not None:
            return self.returncode

        if timeout is not None:
            endtime = _time() + timeout
            # Enter a busy loop if we have a timeout.  This busy loop was
            # cribbed from Lib/threading.py in Thread.wait() at r71065.
            delay = 0.0005 # 500 us -> initial delay of 1 ms
            while True:
                if self._waitpid_lock.acquire(False):
                    try:
                        if self.returncode is not None:
                            break  # Another thread waited.
                        (pid, sts) = self._try_wait(os.WNOHANG)
                        assert pid == self.pid or pid == 0
                        if pid == self.pid:
                            self._handle_exitstatus(sts)
                            break
                    finally:
                        self._waitpid_lock.release()
                remaining = self._remaining_time(endtime)
                if remaining <= 0:
>                   raise TimeoutExpired(self.args, timeout)
E                   subprocess.TimeoutExpired: Command '['/app/venv/bin/xonsh', '--no-rc', '-i']' timed out after 5 seconds

/usr/lib/python3.12/subprocess.py:2045: TimeoutExpired
_________________________ test_on_postcommand_waiting __________________________

tmpdir = local('/tmp/pytest-of-root/pytest-0/test_on_postcommand_waiting0')

    @skip_if_on_windows
    def test_on_postcommand_waiting(tmpdir):
        """Ensure that running a subcommand in the on_postcommand hook doesn't
        block xonsh from exiting when there is a running foreground process."""
        outdir = tmpdir.mkdir("xonsh_test_dir")

        stdin_cmd = f"""
    sleep 0.2
    @events.on_postcommand
    def postcmd_hook(**kwargs):
        touch {outdir}/sighup_test_postcommand

    (sleep 1 && kill -SIGHUP @(__import__('os').getppid())) &
    bash -c "trap '' HUP; sleep 30"
    """
        proc = run_xonsh(
            cmd=None,
            stdin_cmd=stdin_cmd,
            stderr=sp.PIPE,
            interactive=True,
            single_command=False,
            blocking=False,
        )
>       proc.wait(timeout=5)

tests/test_integrations.py:1412:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python3.12/subprocess.py:1264: in wait
    return self._wait(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <Popen: returncode: None args: ['/app/venv/bin/xonsh', '--no-rc', '-i']>
timeout = 5

    def _wait(self, timeout):
        """Internal implementation of wait() on POSIX."""
        if self.returncode is not None:
            return self.returncode

        if timeout is not None:
            endtime = _time() + timeout
            # Enter a busy loop if we have a timeout.  This busy loop was
            # cribbed from Lib/threading.py in Thread.wait() at r71065.
            delay = 0.0005 # 500 us -> initial delay of 1 ms
            while True:
                if self._waitpid_lock.acquire(False):
                    try:
                        if self.returncode is not None:
                            break  # Another thread waited.
                        (pid, sts) = self._try_wait(os.WNOHANG)
                        assert pid == self.pid or pid == 0
                        if pid == self.pid:
                            self._handle_exitstatus(sts)
                            break
                    finally:
                        self._waitpid_lock.release()
                remaining = self._remaining_time(endtime)
                if remaining <= 0:
>                   raise TimeoutExpired(self.args, timeout)
E                   subprocess.TimeoutExpired: Command '['/app/venv/bin/xonsh', '--no-rc', '-i']' timed out after 5 seconds

/usr/lib/python3.12/subprocess.py:2045: TimeoutExpired
___________________ test_suspended_captured_process_pipeline ___________________

    @skip_if_on_windows
    def test_suspended_captured_process_pipeline():
        """See also test_specs.py:test_specs_with_suspended_captured_process_pipeline"""
        stdin_cmd = "!(python -c 'import os, signal, time; time.sleep(0.2); os.kill(os.getpid(), signal.SIGTTIN)')\n"
>       out, err, ret = run_xonsh(
            cmd=None, stdin_cmd=stdin_cmd, interactive=True, single_command=False, timeout=5
        )

tests/test_integrations.py:1419:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests/test_integrations.py:115: in run_xonsh
    out, err = proc.communicate(input=input, timeout=timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/subprocess.py:1209: in communicate
    stdout, stderr = self._communicate(input, endtime, timeout)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/subprocess.py:2116: in _communicate
    self._check_timeout(endtime, orig_timeout, stdout, stderr)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <Popen: returncode: None args: ['/app/venv/bin/xonsh', '--no-rc', '-i']>
endtime = 20359072.055811808, orig_timeout = 5
stdout_seq = [b'Warning: Input is not a terminal (fd=0).\n', b'\r', b'(venv) root@a36fd70f2a2c /app main @#\r\n\r\n\r\n\r\n\r\n\r\n...nal.SIGTTIN)'],\r\n  timestamps=[1757156486.2713127, 1757156486.7748153],\r\n  input='',\r\n  output=''\r\n)\r\n", ...]
stderr_seq = None, skip_check_and_raise = False

    def _check_timeout(self, endtime, orig_timeout, stdout_seq, stderr_seq,
                       skip_check_and_raise=False):
        """Convenience for checking if a timeout has expired."""
        if endtime is None:
            return
        if skip_check_and_raise or _time() > endtime:
>           raise TimeoutExpired(
                    self.args, orig_timeout,
                    output=b''.join(stdout_seq) if stdout_seq else None,
                    stderr=b''.join(stderr_seq) if stderr_seq else None)
E           subprocess.TimeoutExpired: Command '['/app/venv/bin/xonsh', '--no-rc', '-i']' timed out after 5 seconds

/usr/lib/python3.12/subprocess.py:1253: TimeoutExpired
________________________ test_man_completion[yes-exp0] _________________________

xession = <xonsh.built_ins.XonshSession object at 0x7f8ea44fad20>
check_completer = <function check_completer.<locals>._factory at 0x7f8e83fb9d00>
cmd = 'yes', exp = {'--help', '--version'}

    @skip_if_on_windows
    @pytest.mark.parametrize(
        "cmd,exp",
        [
            [
                "yes",
                {"--version", "--help"},
            ],
            [
                "man",
                {
                    "--all",
                    "--apropos",
                    "--ascii",
                    "--catman",
                    "--config-file",
                    "--debug",
                    "--default",
                    "--ditroff",
                    "--encoding",
                    "--extension",
                    "--global-apropos",
                    "--gxditview",
                    "--help",
                    "--html",
                    "--ignore-case",
                    "--local-file",
                    "--locale",
                    "--location",
                    "--location-cat",
                    "--manpath",
                    "--match-case",
                    "--names-only",
                    "--nh",
                    "--nj",
                    "--no-subpages",
                    "--pager",
                    "--preprocessor",
                    "--prompt",
                    "--recode",
                    "--regex",
                    "--sections",
                    "--systems",
                    "--troff",
                    "--troff-device",
                    "--update",
                    "--usage",
                    "--version",
                    "--warnings",
                    "--whatis",
                    "--wildcard",
                },
            ],
        ],
    )
    def test_man_completion(xession, check_completer, cmd, exp):
        xession.env["MANPATH"] = os.path.dirname(os.path.abspath(__file__))
        completions = check_completer(cmd, complete_fn=complete_from_man, prefix="-")
>       assert completions == exp
E       AssertionError: assert set() == {'--help', '--version'}
E
E         Extra items in the right set:
E         '--help'
E         '--version'
E         Use -v to get more diff

tests/test_man.py:68: AssertionError
________________________ test_man_completion[man-exp1] _________________________

xession = <xonsh.built_ins.XonshSession object at 0x7f8ea44fad20>
check_completer = <function check_completer.<locals>._factory at 0x7f8e83fbaac0>
cmd = 'man'
exp = {'--all', '--apropos', '--ascii', '--catman', '--config-file', '--debug', ...}

    @skip_if_on_windows
    @pytest.mark.parametrize(
        "cmd,exp",
        [
            [
                "yes",
                {"--version", "--help"},
            ],
            [
                "man",
                {
                    "--all",
                    "--apropos",
                    "--ascii",
                    "--catman",
                    "--config-file",
                    "--debug",
                    "--default",
                    "--ditroff",
                    "--encoding",
                    "--extension",
                    "--global-apropos",
                    "--gxditview",
                    "--help",
                    "--html",
                    "--ignore-case",
                    "--local-file",
                    "--locale",
                    "--location",
                    "--location-cat",
                    "--manpath",
                    "--match-case",
                    "--names-only",
                    "--nh",
                    "--nj",
                    "--no-subpages",
                    "--pager",
                    "--preprocessor",
                    "--prompt",
                    "--recode",
                    "--regex",
                    "--sections",
                    "--systems",
                    "--troff",
                    "--troff-device",
                    "--update",
                    "--usage",
                    "--version",
                    "--warnings",
                    "--whatis",
                    "--wildcard",
                },
            ],
        ],
    )
    def test_man_completion(xession, check_completer, cmd, exp):
        xession.env["MANPATH"] = os.path.dirname(os.path.abspath(__file__))
        completions = check_completer(cmd, complete_fn=complete_from_man, prefix="-")
>       assert completions == exp
E       AssertionError: assert set() == {'--all', '--...--debug', ...}
E
E         Extra items in the right set:
E         '--all'
E         '--ditroff'
E         '--gxditview'
E         '--location-cat'
E         '--html'...
E
E         ...Full output truncated (36 lines hidden), use '-vv' to show

tests/test_man.py:68: AssertionError
=============================== warnings summary ===============================
tests/test_tools.py::test_is_tok_color_dict[val1-False]
tests/test_tools.py::test_is_tok_color_dict[val2-False]
  /app/tests/test_tools.py:2048: RuntimeWarning: "1" is not a valid Token.
    assert is_tok_color_dict(val) == exp

tests/test_tools.py::test_is_tok_color_dict[val3-False]
  /app/tests/test_tools.py:2048: RuntimeWarning: "{Token.Literal.String: '123'}" contains an invalid style.
    assert is_tok_color_dict(val) == exp

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.11-final-0 _______________

Name                                     Stmts   Miss   Cover   Missing
-----------------------------------------------------------------------
xonsh/completers/environment.py             21      1  95.24%   19
xonsh/lib/jsonutils.py                       8      1  87.50%   15
xonsh/parsers/v39.py                        21      1  95.24%   48
xonsh/prompt/job.py                         19      1  94.74%   16
xonsh/api/os.py                             13      2  84.62%   26-27
xonsh/completers/bash.py                    36      2  94.44%   52-53
xonsh/webconfig/__main__.py                  2      2   0.00%   1-3
xonsh/webconfig/file_writes.py              47      2  95.74%   41, 45
xonsh/webconfig/xonsh_data.py               76      2  97.37%   83-84
xonsh/lazyimps.py                            3      3   0.00%   3-11
xonsh/lazyjson.py                            3      3   0.00%   3-11
xonsh/lib/os.py                              3      3   0.00%   3-9
xonsh/lib/subprocess.py                      3      3   0.00%   3-11
xonsh/prompt/times.py                        6      3  50.00%   9-11
xonsh/xoreutils/uname.py                    31      3  90.32%   91-93, 97
xonsh/parsers/v36.py                        73      4  94.52%   95, 134, 165-166
xonsh/prompt/env.py                         40      4  90.00%   74-77
xonsh/shells/ptk_shell/history.py           28      4  85.71%   24, 27, 36, 51
xonsh/lib/lazyjson.py                      174      5  97.13%   149, 154, 166, 223-224
xonsh/lib/modules.py                        65      5  92.31%   41, 46, 53, 79, 82
xonsh/contexts.py                           64      6  90.62%   33, 77, 103, 107, 119-120
xonsh/lib/itertools.py                      20      6  70.00%   33, 58-62
xonsh/shells/dumb_shell.py                   6      6   0.00%   3-12
xonsh/shells/ptk_shell/formatter.py         26      6  76.92%   29-34, 50, 59, 64
xonsh/xoreutils/yes.py                       8      6  25.00%   6-13
xonsh/history/base.py                       67      7  89.55%   92, 111, 116, 129, 167, 173, 189
xonsh/history/dummy.py                      14      7  50.00%   12, 15, 18, 21-24
xonsh/lib/collections.py                    45      7  84.44%   53, 67-73
xonsh/parser.py                             17      7  58.82%   12, 14, 17-22
xonsh/xoreutils/pwd.py                      12      8  33.33%   10-17
xonsh/color_tools.py                        99      9  90.91%   37, 376, 381-383, 424, 497-499
xonsh/platforms/macutils.py                 10     10   0.00%   3-23
xonsh/parsers/lexer.py                     245     11  95.51%   183, 379-380, 403-406, 415-416, 459, 520
xonsh/parsers/v38.py                       189     11  94.18%   52-53, 61-62, 69-71, 118-127, 400, 526
xonsh/shell.py                              94     13  86.17%   117, 169, 174, 176, 179-183, 194, 204, 220-225
xonsh/completers/commands.py               114     15  86.84%   35, 38-40, 43-45, 88, 100, 157-160, 169, 172, 180
xonsh/completers/imports.py                129     15  88.37%   51, 104-105, 113, 121-126, 137-138, 155-156, 183, 189, 214
xonsh/completers/python.py                 124     17  86.29%   149, 212-217, 234, 236, 245, 250-255, 274, 277-278
xonsh/procs/executables.py                  75     18  76.00%   44, 48-49, 64-74, 91-94, 130-131, 159-160
xonsh/xoreutils/util.py                     22     18  18.18%   7-12, 14-19, 23-34
xonsh/completer.py                         124     19  84.68%   53, 57-60, 188, 192, 197-204, 257-261, 270-271, 287-291, 299, 302
xonsh/completers/_aliases.py                70     19  72.86%   17, 77, 80-82, 89-93, 97, 126-133, 155, 165, 170
xonsh/prompt/gitstatus.py                  156     19  87.82%   78-91, 137, 146, 152, 157-160, 179, 187, 204, 206, 208, 220, 225-226, 228
xonsh/webconfig/tags.py                     94     19  79.79%   5, 32-36, 48-49, 52, 104-108, 114, 119-120, 127, 132-135
xonsh/lib/lazyimps.py                       61     23  62.30%   20, 28, 36, 43-46, 51-55, 60-64, 69-73, 78-82, 98
xonsh/codecache.py                         128     24  81.25%   59, 63, 100, 105-109, 114-118, 153-158, 202-206
xonsh/events.py                            140     24  82.86%   75, 83-84, 130, 142-144, 159, 184-185, 191-192, 220, 223-224, 244-245, 250-251, 283-286, 332
xonsh/xoreutils/echo.py                     27     24  11.11%   6-16, 20-32
xonsh/execer.py                            168     26  84.52%   138-148, 159, 174, 191, 207, 215-220, 224, 243-246, 280-283, 311-314
xonsh/parsers/context_check.py              69     26  62.32%   17, 20, 24, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 65-67, 78-80, 86-88, 93-94
xonsh/main.py                              330     27  91.82%   121, 132-133, 276, 353, 391, 394-395, 445-450, 472-473, 482, 487, 489, 494, 522, 556, 604, 618-619, 644-646, 696, 699
xonsh/shells/ptk_shell/completer.py         86     27  68.60%   36, 74, 92, 116, 123-129, 133-151
xonsh/style_tools.py                       111     27  75.68%   35, 51, 55, 71-74, 78-79, 107-118, 149, 155, 158, 160, 164, 176-178
xonsh/xoreutils/tty.py                      32     28  12.50%   9-36
xonsh/completers/man.py                     95     29  69.47%   19, 37, 45, 57, 69-79, 90-91, 98-110, 119, 138
xonsh/completers/tools.py                  138     30  78.26%   19-20, 29-30, 42, 51-52, 112-117, 132, 170, 179-189, 207, 223, 230, 256-259, 266, 275, 281
xonsh/parsers/completion_context.py        534     33  93.82%   73, 87, 92, 97, 102, 121, 148, 254, 299, 408-411, 414, 530-532, 781-784, 824, 929, 949, 964, 989-992, 1046-1047, 1053-1054, 1133
xonsh/xoreutils/cat.py                     100     33  67.00%   18, 26, 29-31, 33, 49, 51-52, 54-55, 80, 84-86, 94-110, 121, 161, 165
xonsh/prompt/cwd.py                         54     34  37.04%   14, 17-18, 29-38, 50-84
xonsh/xoreutils/tee.py                      37     35   5.41%   6-44
xonsh/parsers/v310.py                      243     36  85.19%   45-48, 82-85, 97-98, 115-116, 131-132, 217, 237-238, 267-268, 297, 334-335, 365-366, 445-446, 467-468, 486-487, 519-520, 532-533, 545-546
xonsh/imphooks.py                          156     37  76.28%   43, 47, 73, 100, 106-107, 117, 122, 227-229, 238, 243, 250-259, 288, 295-298, 302-305, 308-310, 325-332
xonsh/xoreutils/which.py                   108     37  65.74%   61, 80-81, 89-93, 95, 107-118, 130-131, 138, 140, 142-145, 152-153, 168, 176, 180-187, 203-206
xonsh/completers/completer.py               60     38  36.67%   26-42, 49-65, 86-93
xonsh/xontribs.py                          221     39  82.35%   19, 42, 46, 52, 58, 78, 93-96, 118, 125, 136, 143, 148, 156, 176, 182, 193, 212, 244, 247-252, 254-255, 279, 289-290, 309, 343-344, 351-355
xonsh/webconfig/main.py                    126     40  68.25%   35, 37-38, 71-73, 93, 118-124, 130-153, 157-161, 166-169, 174
xonsh/lib/openpy.py                         51     41  19.61%   36-52, 59-69, 88-92, 115-121, 128-133
xonsh/webconfig/routes.py                  208     43  79.33%   36-38, 53-55, 102-109, 166-168, 177-179, 246, 251-252, 293, 297, 303, 313, 319-325, 334-335, 341, 349, 355-365, 371-372, 378
xonsh/ansi_colors.py                       332     45  86.45%   46-52, 86, 90-92, 105-112, 125, 159-160, 167, 185-194, 205-211, 250, 256, 294, 298-300, 352-357, 1151-1152
xonsh/parsers/rd_parser.py                  45     45   0.00%   1-78
xonsh/cli_utils.py                         341     50  85.34%   120, 125-127, 172, 233-236, 239-242, 245, 248-250, 253-256, 259-262, 265-275, 278-281, 293, 453, 481, 502-503, 515-516, 535-536, 539, 562, 581-582, 625-628, 632, 636, 662-663
xonsh/history/sqlite.py                    278     52  81.29%   131-132, 139-145, 156, 158, 170, 188-190, 222, 253-262, 284, 289-293, 295, 305, 327-328, 370-371, 385-395, 399-400, 408, 422-425, 440
xonsh/pytest/tools.py                       89     52  41.57%   3-55, 61, 65-73, 77-84, 90-94, 97, 106, 140, 144, 148
xonsh/parsers/ast.py                       347     58  83.29%   152, 198, 201-218, 235, 356, 469, 484-487, 491, 515, 542, 546, 574, 576-580, 597, 661, 674-694, 699, 709
xonsh/built_ins.py                         463     62  86.61%   115-121, 171-172, 175, 254, 279, 287-290, 318, 359, 379-380, 406, 410, 440, 477-480, 509-511, 530-532, 540, 554-558, 561-565, 569-573, 577, 581, 585, 589, 593-595, 655, 660, 715, 732-733, 780, 836, 839, 842, 845, 848, 854
xonsh/commands_cache.py                    326     66  79.75%   71, 84, 92, 98-108, 114, 119-120, 178-179, 186, 189-190, 194, 226, 230-231, 281-283, 378, 440, 453-463, 477, 479-483, 487-488, 501-505, 519-520, 560-565, 576-578, 583-588, 596-600, 608-613
xonsh/tracer.py                            125     68  45.60%   49-50, 62-70, 74-82, 86-104, 121-126, 141-146, 159, 170-184, 194-212
xonsh/prompt/vc.py                         186     75  59.68%   63-64, 72, 75-76, 78-79, 101-126, 130-132, 140-147, 155-159, 186, 188, 190-191, 206, 234-255, 262-269, 281, 283, 295-298, 306-313
xonsh/prompt/base.py                       286     78  72.73%   15-17, 22, 51-53, 122-123, 144, 150, 181, 186-228, 233-244, 280, 283-289, 294, 378, 397-401, 438, 444, 447, 505
xonsh/shells/ptk_shell/updator.py          103     78  24.27%   19-25, 28-31, 43-47, 64-73, 88-116, 122-136, 140-142, 152-154, 161-167, 171-179, 182-184, 188-199, 202-205, 208-209
xonsh/lib/lazyasd.py                       184     79  57.07%   72-73, 76-77, 84-85, 88-89, 96-97, 100-101, 104-105, 112-113, 116, 119, 185-186, 189-193, 199, 204, 259, 262-280, 287-292, 298-316, 348-359
xonsh/shells/ptk_shell/__init__.py         364     81  77.75%   45, 94, 100, 142-144, 156-162, 192, 201, 233, 253-256, 262-275, 278-283, 306, 318-319, 324, 328, 333, 368, 389, 397-400, 406, 420-427, 434, 449-450, 476, 482, 492, 501-502, 509-513, 521, 523, 531, 542-549, 551-552, 559, 573, 589-591, 595-599, 626, 630
xonsh/xoreutils/umask.py                   106     83  21.70%   11, 29-31, 35, 42-44, 48-51, 59-65, 69-70, 80-83, 89-111, 115-118, 122-165, 179-181
xonsh/procs/posix.py                       328     86  73.78%   64-67, 96, 102-104, 146-151, 176-177, 213-214, 223, 260-278, 285, 287, 301-302, 316, 326-330, 339-341, 349-351, 360, 365, 368-370, 376, 379-384, 394-395, 404, 411-428, 433-440, 487, 499-500, 502, 505-507, 512, 516
xonsh/history/json.py                      438     91  79.22%   16, 118-120, 173, 176-177, 182, 224, 228, 239-251, 265, 277-278, 283-288, 304-305, 404, 410, 488, 490-491, 557, 597, 614-616, 619-624, 633-643, 647-648, 655, 669-672, 692-728
xonsh/procs/pipelines.py                   551     94  82.94%   69-70, 78-79, 85, 211, 214, 224-228, 239, 278, 280-283, 309-310, 318-320, 334, 341-345, 366-370, 397, 403, 405, 424, 426, 436, 464, 504, 508-515, 518-522, 537-544, 559, 572, 622, 640, 642, 658, 663, 668, 673, 684-689, 701, 706-707, 712-713, 718-719, 724-725, 748, 758-761, 766-769, 774-777, 836-837, 875-878, 887-891
xonsh/history/main.py                      254     96  62.20%   25-31, 45-49, 53-59, 71-73, 87-90, 95, 106-112, 129-143, 151-153, 192-200, 284-286, 292-294, 303-305, 312, 317-320, 335-348, 354-357, 392-394, 399-402, 416-424, 443-444, 498-509
xonsh/parsers/fstring_adaptor.py           114     98  14.04%   13, 18, 38-43, 50-85, 89-108, 113-132, 137-187, 191-197
xonsh/pytest/plugin.py                     219     98  55.25%   6-29, 33, 40-52, 57-58, 71-72, 77, 80-87, 91-99, 104-105, 113-114, 122-123, 133-146, 153-154, 163-164, 171-172, 189-190, 194-195, 201-202, 211-212, 225-226, 246, 288-289, 294-295, 300-301, 306-307, 311-312, 316-317, 349, 361-362, 376-377, 392-393, 408
xonsh/xoreutils/_which.py                  157    100  36.31%   111-124, 130, 147-149, 152-153, 155-156, 189, 195-205, 208, 216-219, 230, 240-243, 249-251, 272-279, 299-302, 309-366, 370
xonsh/completers/bash_completion.py        206    102  50.49%   24-31, 37-62, 67-71, 78-99, 108-110, 113, 122, 133, 136, 150-151, 158-163, 185, 187, 191, 193, 196-199, 347, 359-367, 382, 392, 411-413, 419, 431, 459-475, 480-500, 504
xonsh/completers/path.py                   273    103  62.27%   18, 31-32, 56-60, 76-77, 79-80, 98, 100, 102, 107-109, 113, 122, 129, 136-145, 149-154, 161, 184, 193, 207-216, 222-227, 231-240, 254-257, 261-268, 272-280, 300, 314-329, 331-338, 340, 343-344, 362
xonsh/shells/ptk_shell/key_bindings.py     248    107  56.85%   79, 83, 102-103, 114-116, 122, 130-133, 143-147, 164-170, 183-184, 195-196, 204-213, 236-254, 262-263, 268-272, 277, 282-287, 292-300, 304-309, 318-328, 336-345, 350-352, 365, 370, 375-376, 383-386, 391-394, 399, 406, 411-412, 417-418, 423-426, 446-451
xonsh/procs/readers.py                     217    109  49.77%   35, 105, 114-118, 169-181, 199-209, 215-221, 268-360, 382-394
xonsh/pygments_cache.py                    251    111  55.78%   22, 33-39, 110-112, 128-129, 135, 152-154, 163, 170-171, 182-183, 190, 204-206, 212-213, 219, 233-235, 242-243, 249, 267, 295-299, 320, 325, 328, 342-364, 375-397, 404-424, 432, 448-450, 468-488
xonsh/xoreutils/ulimit.py                  127    112  11.81%   122-137, 142-151, 156-167, 172-175, 180-181, 186-187, 192-250, 255-285, 301-319
xonsh/shells/base_shell.py                 367    115  68.66%   34-37, 80, 84-85, 89-90, 94-96, 102, 104, 109, 141, 160, 165, 185, 188, 190, 206-207, 211-212, 216, 222-225, 231-234, 240, 282, 339, 348, 357-358, 364-365, 397-399, 402-405, 428, 452, 463-464, 467-479, 482, 496, 507-512, 515-516, 527, 529-543, 564-575, 582-599, 625, 630, 634, 641
xonsh/timings.py                           186    115  38.17%   29-32, 45-55, 60-70, 85, 91-105, 110-141, 160-168, 184-243, 269, 274, 284, 289, 299, 304, 309, 314, 319, 324-340
xonsh/environ.py                           866    118  86.37%   157, 186-188, 388, 394, 397, 468-470, 481, 486, 492-498, 500, 509-516, 609, 623, 655, 711, 844-846, 850-853, 857-862, 2058-2060, 2068-2069, 2082, 2090, 2098, 2102, 2117-2120, 2127-2129, 2133, 2140, 2147, 2180-2182, 2198-2200, 2211, 2230-2239, 2326-2333, 2350, 2352-2353, 2398, 2401, 2404, 2407-2413, 2469, 2497-2499, 2556-2557, 2565-2566, 2584, 2633-2644, 2649-2650, 2666, 2673-2674, 2679, 2712
xonsh/xoreutils/uptime.py                  158    118  25.32%   28-40, 50-56, 61-64, 69-72, 78-100, 105-110, 118-128, 133-187, 192-195, 203-214, 219-224, 230, 232, 236-250, 265, 270-272, 276
xonsh/foreign_shells.py                    269    130  51.67%   80, 202, 227, 229, 234-237, 239, 252-255, 258, 292, 313, 336-349, 366-382, 405-409, 412, 418-420, 425-442, 445, 455-459, 484-487, 490-492, 522-525, 528-530, 535, 555-610, 627-633, 650-666
xonsh/history/diff_history.py              207    132  36.23%   18-36, 40, 44, 49-73, 104, 111-116, 132-141, 144-153, 159-178, 181-192, 201-211, 215, 219-236, 249-258, 260-261, 263-264, 269-284, 287, 294, 297
xonsh/pyghooks.py                          617    136  77.96%   112-130, 165, 170, 224, 242-243, 256, 266-277, 281-315, 331-333, 347, 353, 386-392, 402-403, 418, 422, 436-445, 454, 465, 474, 583, 1324-1340, 1359, 1392-1396, 1424, 1426, 1430, 1437, 1449, 1451, 1453, 1455, 1457, 1461, 1463, 1465, 1467, 1569-1578, 1607-1608, 1650-1651
xonsh/lib/pretty.py                        469    141  69.94%   112-113, 123, 153-157, 162-166, 197, 280-283, 309-316, 377, 389, 396-398, 418-419, 425, 520-545, 562, 565, 575, 587-617, 636, 639, 656-661, 669-670, 690, 703-704, 712-716, 721, 745-755, 785-786, 806-810, 819, 839-847, 851-856, 860-865, 869-874
xonsh/platform.py                          342    156  54.39%   32-33, 79, 85, 101, 115, 147, 157, 175, 184, 198-205, 210-211, 219, 222, 237, 268, 279-285, 309, 315-316, 340, 342, 344, 348, 360-367, 375-402, 411-462, 473, 481, 483, 496-514, 522, 542-553, 564-621
xonsh/lib/inspectors.py                    381    157  58.79%   98, 100, 125-126, 132-135, 159, 162-164, 198, 226-251, 272, 286-287, 308-323, 341-342, 346-350, 358-372, 383-403, 408-414, 418-436, 448-459, 505, 554, 598-600, 603-611, 615, 624, 626, 634-635, 643-644, 648-649, 652, 669, 671, 688-690, 697-698, 709-710, 738-739, 746, 754-755, 757, 761-773, 785, 790-792, 800
xonsh/dirstack.py                          292    161  44.86%   25-29, 33-40, 53-71, 76, 99-115, 130-138, 154-155, 164, 169-173, 200, 215-216, 224-227, 229-241, 245, 255, 257, 259, 266, 278, 320-321, 327-331, 335-360, 363, 372, 409-410, 419-448, 458-459, 464, 501-502, 508-509, 512, 518-523, 525, 530-552
xonsh/parsers/v313.py                      166    166   0.00%   11-264
xonsh/procs/jobs.py                        356    166  53.37%   69, 78, 91-93, 101, 130-138, 165-175, 178, 182-190, 200-201, 208-239, 244-245, 248, 273-292, 306, 310, 314, 320, 327, 348-351, 361-370, 409-410, 422-425, 483-514, 537-541, 548-581, 595, 605-611, 643-671
xonsh/procs/proxies.py                     439    166  62.19%   31-36, 44-45, 53-56, 59-62, 65, 91, 115, 135, 140, 145, 154, 158, 162, 166, 170, 174, 184-185, 191, 199, 204, 208, 218, 222, 226, 230, 234, 238, 282-283, 368-373, 376-378, 385-387, 390-392, 414, 426-431, 440, 484-498, 515, 550-567, 576-577, 579, 584-586, 590-668, 683, 685, 690, 695, 697, 707, 709, 711, 713, 758, 765, 774-778, 811-821, 827
xonsh/aliases.py                           466    176  62.23%   157-158, 188-189, 195-202, 253-260, 272-273, 343, 346, 349, 404-406, 411-412, 415, 422-427, 434-435, 442-443, 450-451, 458-459, 466-467, 474-475, 489-490, 510-526, 572, 587, 657-731, 767-773, 776, 794-803, 853-862, 943-944, 970-975, 993-996, 1004, 1014, 1017, 1023, 1029-1031, 1041-1042, 1097-1143, 1145, 1147-1150, 1152-1154, 1156
xonsh/procs/specs.py                       681    181  73.42%   42-49, 62-68, 72-80, 91-97, 103, 110-112, 119, 125, 127-130, 180-185, 190-197, 205-215, 218, 220, 227, 244, 247-252, 269, 276-277, 295, 299, 427-431, 434-438, 452-458, 468-474, 484-490, 493, 527, 531-557, 567, 573, 584-585, 599, 617-618, 624-625, 627-628, 715, 720-722, 740, 766-767, 786-788, 832, 834, 836, 838, 864, 912-914, 916-918, 936-937, 939-940, 962, 973-1012, 1043, 1068, 1101, 1156
xonsh/parsers/base.py                     1614    200  87.61%   80, 98, 127-134, 140, 152, 158, 178-185, 206, 519, 561-564, 643-644, 646-651, 702-704, 709, 837-849, 870-880, 888, 895-899, 904-907, 912-916, 921-925, 930-934, 939-943, 947-952, 957-962, 967-977, 1013, 1052, 1056, 1062-1066, 1071-1075, 1080-1084, 1089-1093, 1098-1103, 1108-1113, 1117-1127, 1229, 1247, 1259, 1409-1410, 1456, 1491, 1503-1504, 1566, 1904-1917, 1921, 2035-2036, 2047, 2196, 2286, 2305, 2330-2335, 2514-2515, 2517-2522, 2542-2543, 2545-2550, 2606, 2706-2707, 2824-2836, 2844-2845, 3082, 3118, 3120, 3142, 3153-3157, 3191-3200, 3248, 3317-3322, 3326-3327, 3331-3332, 3348-3349, 3353-3354, 3358-3372, 3401, 3409-3410, 3417-3418, 3595-3597, 3608
xonsh/parsers/tokenize.py                  529    205  61.25%   119-121, 239-240, 248-251, 625-628, 631-642, 645-679, 682-715, 738-742, 748-755, 786-787, 795-799, 804-824, 828-830, 836, 846, 855-864, 883, 888-889, 936, 974, 981-983, 988-990, 1021-1022, 1028, 1033-1034, 1071-1078, 1094-1104, 1116, 1125-1126, 1135-1136, 1183, 1187-1251
xonsh/platforms/winutils.py                205    205   0.00%   24-549
xonsh/wizard.py                            470    219  53.40%   158-162, 186-187, 194, 207, 231-245, 284, 292, 400, 428-434, 459, 466-469, 485-495, 500-503, 511, 523, 531, 533, 539-550, 553-557, 560-574, 580, 587-588, 597, 599, 603, 637-647, 661, 666-668, 716-719, 722-723, 726, 729, 732-737, 740-773, 776-788, 791-813, 816-833, 837-867
xonsh/shells/readline_shell.py             438    234  46.58%   52, 86-92, 105-107, 112-114, 117-118, 133-134, 158, 165, 169-171, 187-188, 194-202, 212-225, 232-234, 242-246, 253, 259-269, 275-286, 292-296, 387-400, 412-445, 449-491, 497-505, 513-514, 516-534, 552-554, 556-557, 560, 562, 568-569, 571-585, 589, 593, 605, 609-614, 620-626, 637-643, 650-651, 671-677, 682, 686-687, 694-707, 724-725, 728, 735
xonsh/xonfig.py                            367    244  33.51%   150-186, 190-194, 198, 203, 215-269, 274-277, 291-296, 301-331, 335-342, 347-348, 356, 361-379, 384, 400-439, 455-478, 487, 495-496, 506-508, 544, 558-559, 592-606, 610-624, 628-650, 667-687, 692-694, 709-711, 722, 734, 744, 749-758, 763, 824-841
xonsh/tools.py                            1482    380  74.36%   54-55, 88, 129-131, 190-191, 221, 245, 263-264, 274, 283-291, 300, 347, 432, 470, 472, 513, 524, 547-548, 550, 585, 596, 608-610, 713-714, 718-719, 724, 762-773, 781, 791-794, 847-865, 872-876, 885-892, 898-937, 944-945, 965, 970-975, 982-983, 1030, 1042, 1064-1065, 1120, 1147-1163, 1169-1174, 1234-1240, 1315, 1340, 1342, 1398, 1489-1492, 1525, 1530-1531, 1543, 1545, 1704, 1709, 1714, 1721-1743, 1748, 1755, 1757, 1759, 1762, 1765-1768, 1773, 1775, 1777-1780, 1782, 1785, 1845, 1869-1877, 1882-1889, 1896, 1975-1982, 2043-2052, 2071-2078, 2087, 2093, 2098, 2103, 2146-2158, 2163-2167, 2172-2184, 2220-2238, 2246, 2265-2285, 2290-2298, 2305-2319, 2328, 2338-2361, 2429, 2431, 2435-2446, 2560-2566, 2571, 2594-2596, 2641-2642, 2665-2667, 2680-2682, 2703-2704, 2712-2751, 2771-2772, 2851-2857, 2870-2881
-----------------------------------------------------------------------
TOTAL                                    24199   7394  69.45%

20 files skipped due to complete coverage.
Coverage XML written to file coverage.xml
Required test coverage of 60.0% reached. Total coverage: 69.45%
=========================== short test summary info ============================
FAILED tests/completers/test_bash_completer.py::test_bash_completer[command_context0-completions0-5]
FAILED tests/completers/test_bash_completer.py::test_bash_completer[command_context1-completions1-0]
FAILED tests/completers/test_bash_completer.py::test_bash_completer[command_context2-completions2-2]
FAILED tests/completers/test_bash_completer.py::test_bash_completer[command_context3-completions3-1]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context0-completions0-4]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context1-completions1-5]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context2-completions2-5]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context3-completions3-6]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context4-completions4-10]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context5-completions5-4]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context6-completions6-5]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context7-completions7-5]
FAILED tests/completers/test_bash_completer.py::test_quote_handling[command_context8-completions8-6]
FAILED tests/completers/test_bash_completer.py::test_bash_completer_empty_prefix
FAILED tests/completers/test_bash_completer.py::test_equal_sign_arg[command_context0-completions0-3-False]
FAILED tests/completers/test_bash_completer.py::test_equal_sign_arg[command_context1-completions1-3-True]
FAILED tests/completers/test_bash_completer.py::test_equal_sign_arg[command_context2-completions2-2-True]
FAILED tests/completers/test_bash_completer.py::test_equal_sign_arg[command_context3-completions3-3-False]
FAILED tests/completers/test_bash_completer.py::test_equal_sign_arg[command_context4-completions4-8-True]
FAILED tests/platform/test_platform.py::test_githash_value_error - AssertionE...
FAILED tests/test_builtins.py::test_repath_backslash - AssertionError: assert...
FAILED tests/test_integrations.py::test_catching_system_exit - subprocess.Tim...
FAILED tests/test_integrations.py::test_catching_exit_signal - subprocess.Tim...
FAILED tests/test_integrations.py::test_forwarding_sighup - subprocess.Timeou...
FAILED tests/test_integrations.py::test_on_postcommand_waiting - subprocess.T...
FAILED tests/test_integrations.py::test_suspended_captured_process_pipeline
FAILED tests/test_man.py::test_man_completion[yes-exp0] - AssertionError: ass...
FAILED tests/test_man.py::test_man_completion[man-exp1] - AssertionError: ass...
= 28 failed, 5013 passed, 126 skipped, 17 xfailed, 1 xpassed, 3 warnings, 6 rerun in 624.77s (0:10:24) =
