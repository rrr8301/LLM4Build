
> @google/gemini-cli@0.1.21 prepare
> npm run bundle


> @google/gemini-cli@0.1.21 bundle
> npm run generate && node esbuild.config.js && node scripts/copy_bundle_assets.js


> @google/gemini-cli@0.1.21 generate
> node scripts/generate-git-commit-info.js

/bin/sh: 1: git: not found
Assets copied to bundle/

added 15 packages, changed 1 package, and audited 938 packages in 3s

291 packages are looking for funding
  run `npm fund` for details

1 low severity vulnerability

To address all issues, run:
  npm audit fix

Run `npm audit` for details.

> @google/gemini-cli@0.1.21 build
> node scripts/build.js


> @google/gemini-cli@0.1.21 generate
> node scripts/generate-git-commit-info.js

/bin/sh: 1: git: not found

> @google/gemini-cli@0.1.21 build
> node ../../scripts/build_package.js

Successfully copied files.

> @google/gemini-cli-core@0.1.21 build
> node ../../scripts/build_package.js

Successfully copied files.

> @google/gemini-cli-test-utils@0.1.21 build
> node ../../scripts/build_package.js

Successfully copied files.

> gemini-cli-vscode-ide-companion@0.1.21 build
> npm run compile


> gemini-cli-vscode-ide-companion@0.1.21 compile
> npm run check-types && npm run lint && node esbuild.js


> gemini-cli-vscode-ide-companion@0.1.21 check-types
> tsc --noEmit


> gemini-cli-vscode-ide-companion@0.1.21 lint
> eslint src

[watch] build started
[watch] build finished

> @google/gemini-cli@0.1.21 test:ci
> npm run test:ci --workspaces --if-present && npm run test:scripts


> @google/gemini-cli@0.1.21 test:ci
> vitest run --coverage


 RUN  v3.2.4 /app/packages/cli
      Coverage enabled with v8

 âœ“ src/utils/settingsUtils.test.ts (68 tests) 50ms
 âœ“ src/utils/installationInfo.test.ts (16 tests) 29ms
 âœ“ src/ui/utils/computeStats.test.ts (12 tests) 15ms
 âœ“ src/ui/utils/commandUtils.test.ts (26 tests) 70ms
 âœ“ src/config/settingsSchema.test.ts (14 tests) 39ms
 âœ“ src/ui/themes/color-utils.test.ts (16 tests) 28ms
 âœ“ src/ui/utils/updateCheck.test.ts (9 tests) 29ms
 âœ“ src/ui/commands/copyCommand.test.ts (11 tests) 30ms
 âœ“ src/ui/commands/initCommand.test.ts (3 tests) 22ms
 âœ“ src/ui/commands/restoreCommand.test.ts (13 tests) 75ms
 âœ“ src/ui/keyMatchers.test.ts (32 tests) 20ms
 âœ“ src/ui/commands/toolsCommand.test.ts (4 tests) 23ms
 âœ“ src/ui/commands/aboutCommand.test.ts (5 tests) 23ms
 âœ“ src/services/CommandService.test.ts (11 tests) 28ms
 âœ“ src/ui/commands/compressCommand.test.ts (5 tests) 22ms
 âœ“ src/commands/mcp/list.test.ts (4 tests) 21ms
 âœ“ src/utils/gitUtils.test.ts (12 tests) 35ms
 âœ“ src/ui/commands/setupGithubCommand.test.ts (8 tests) 70ms
 âœ“ src/ui/hooks/useTimer.test.ts (8 tests) 51ms
 âœ“ src/ui/hooks/useHistoryManager.test.ts (8 tests) 65ms
 âœ“ src/ui/hooks/usePhraseCycler.test.ts (7 tests) 66ms
 âœ“ src/ui/hooks/useInputHistory.test.ts (11 tests) 70ms
 âœ“ src/ui/hooks/useConsoleMessages.test.ts (7 tests) 68ms
 âœ“ src/ui/hooks/useGitBranchName.test.ts (7 tests | 2 skipped) 79ms
 âœ“ src/ui/hooks/useMessageQueue.test.ts (9 tests) 75ms
 âœ“ src/ui/hooks/useLoadingIndicator.test.ts (5 tests) 75ms
 âœ“ src/ui/hooks/useSlashCompletion.test.ts (15 tests) 142ms
 âœ“ src/ui/hooks/usePrivacySettings.test.ts (6 tests) 321ms
 âœ“ src/ui/commands/bugCommand.test.ts (2 tests) 12ms
 âœ“ src/ui/hooks/shellCommandProcessor.test.ts (12 tests) 94ms
 âœ“ src/ui/hooks/useShellHistory.test.ts (7 tests) 584ms
 âœ“ src/ui/themes/theme.test.ts (5 tests) 10ms
 âœ“ src/ui/themes/theme-manager.test.ts (12 tests) 42ms
 âœ“ src/ui/hooks/useFocus.test.ts (5 tests) 46ms
 âœ“ src/ui/components/shared/MaxSizedBox.test.tsx (21 tests) 210ms
 âœ“ src/ui/components/messages/ToolMessage.test.tsx (11 tests) 154ms
 âœ“ src/ui/components/LoadingIndicator.test.tsx (15 tests) 156ms
 âœ“ src/ui/components/messages/ToolGroupMessage.test.tsx (14 tests) 206ms
 âœ“ src/ui/commands/docsCommand.test.ts (3 tests) 14ms
 âœ“ src/utils/userStartupWarnings.test.ts (5 tests) 17ms
 âœ“ src/ui/utils/markdownUtilities.test.ts (7 tests) 10ms
 âœ“ src/ui/utils/clipboardUtils.test.ts (6 tests) 7ms
 âœ“ src/utils/readStdin.test.ts (4 tests) 19ms
 âœ“ src/config/keyBindings.test.ts (3 tests) 13ms
 âœ“ src/ui/utils/formatters.test.ts (14 tests) 9ms
 âœ“ src/test-utils/mockCommandContext.test.ts (3 tests) 13ms
 âœ“ src/ui/commands/statsCommand.test.ts (3 tests) 39ms
 âœ“ src/ui/commands/extensionsCommand.test.ts (2 tests) 16ms
 âœ“ src/ui/utils/displayUtils.test.ts (5 tests) 7ms
 âœ“ src/ui/components/messages/DiffRenderer.test.tsx (13 tests) 645ms
 âœ“ src/ui/commands/terminalSetupCommand.test.ts (5 tests) 8ms
 âœ“ src/ui/commands/themeCommand.test.ts (2 tests) 11ms
 âœ“ src/services/prompt-processors/argumentProcessor.test.ts (2 tests) 10ms
 âœ“ src/ui/commands/helpCommand.test.ts (2 tests) 11ms
 âœ“ src/ui/commands/privacyCommand.test.ts (2 tests) 11ms
 âœ“ src/ui/commands/quitCommand.test.ts (1 test) 14ms
 âœ“ src/ui/commands/settingsCommand.test.ts (2 tests) 14ms
 âœ“ src/ui/commands/corgiCommand.test.ts (2 tests) 11ms
 âœ“ src/ui/commands/authCommand.test.ts (2 tests) 12ms
 âœ“ src/ui/commands/editorCommand.test.ts (2 tests) 9ms
 âœ“ src/config/extensions/variables.test.ts (1 test) 6ms
 âœ“ src/ui/components/Header.test.tsx (4 tests) 157ms
 âœ“ src/ui/contexts/SessionContext.test.tsx (3 tests) 81ms
 âœ“ src/ui/hooks/useToolScheduler.test.ts (21 tests | 4 skipped) 88ms
 âœ“ src/config/trustedFolders.test.ts (12 tests) 13ms
 â†“ src/utils/startupWarnings.test.ts (4 tests | 4 skipped)
 âœ“ src/services/prompt-processors/shellProcessor.test.ts (37 tests) 77ms
 âœ“ src/ui/hooks/useEditorSettings.test.ts (10 tests) 69ms
 âœ“ src/utils/cleanup.test.ts (4 tests) 9ms
 âœ“ src/ui/commands/clearCommand.test.ts (2 tests) 9ms
 âœ“ src/ui/components/ModelStatsDisplay.test.tsx (6 tests) 218ms
 âœ“ src/commands/mcp/remove.test.ts (2 tests) 42ms
 âœ“ src/services/McpPromptLoader.test.ts (10 tests) 11ms
 âœ“ src/config/extension.test.ts (24 tests) 74ms
 âœ“ src/ui/commands/directoryCommand.test.tsx (7 tests) 18ms
 âœ“ src/ui/components/messages/ToolConfirmationMessage.test.tsx (14 tests) 198ms
 âœ“ src/commands/extensions/uninstall.test.ts (1 test) 27ms
 âœ“ src/config/auth.test.ts (8 tests) 14ms
 âœ“ src/ui/commands/chatCommand.test.ts (17 tests) 35ms
 âœ“ src/config/settings.test.ts (47 tests) 47ms
 âœ“ src/ui/components/shared/vim-buffer-actions.test.ts (74 tests) 51ms
 âœ“ src/validateNonInterActiveAuth.test.ts (11 tests) 22ms
 âœ“ src/ui/components/HistoryItemDisplay.test.tsx (7 tests) 137ms
 âœ“ src/ui/commands/mcpCommand.test.ts (35 tests) 72ms
 âœ“ src/ui/commands/memoryCommand.test.ts (8 tests) 24ms
 âœ“ src/ui/utils/MarkdownDisplay.test.tsx (16 tests) 358ms
 âœ“ src/commands/mcp/add.test.ts (5 tests) 81ms
 âœ“ src/ui/components/ContextSummaryDisplay.test.tsx (4 tests) 59ms
 âœ“ src/ui/hooks/useFolderTrust.test.ts (9 tests) 69ms
 âœ“ src/ui/components/shared/text-buffer.test.ts (103 tests) 334ms
 âœ“ src/services/FileCommandLoader.test.ts (32 tests) 131ms
 âœ“ src/ui/hooks/useReverseSearchCompletion.test.tsx (10 tests) 68ms
 âœ“ src/ui/components/ToolStatsDisplay.test.tsx (5 tests) 164ms
 âœ“ src/ui/components/SessionSummaryDisplay.test.tsx (1 test) 130ms
 âœ“ src/commands/extensions/install.test.ts (2 tests) 29ms
 âœ“ src/utils/handleAutoUpdate.test.ts (10 tests) 24ms
 âœ“ src/ui/hooks/useGeminiStream.test.tsx (26 tests) 512ms
 âœ“ src/services/BuiltinCommandLoader.test.ts (4 tests) 10ms
 âœ“ src/commands/mcp.test.ts (3 tests) 16ms
 âœ“ src/ui/hooks/atCommandProcessor.test.ts (39 tests) 561ms
 âœ“ src/nonInteractiveCli.test.ts (7 tests) 31ms
 âœ“ src/ui/components/AuthDialog.test.tsx (10 tests) 618ms
 âœ“ src/ui/components/StatsDisplay.test.tsx (12 tests) 351ms
 âœ“ src/ui/components/ShellConfirmationDialog.test.tsx (4 tests) 169ms
 âœ“ src/ui/hooks/vim.test.ts (87 tests) 613ms
 âœ“ src/ui/hooks/useKeypress.test.ts (18 tests) 67ms
 âœ“ src/ui/hooks/useAutoAcceptIndicator.test.ts (11 tests) 82ms
 âœ“ src/ui/contexts/KeypressContext.test.tsx (17 tests) 102ms
 âœ“ src/ui/components/Footer.test.tsx (13 tests) 104ms
 âœ“ src/ui/hooks/useCommandCompletion.test.ts (17 tests) 132ms
 âœ“ src/ui/components/FolderTrustDialog.test.tsx (6 tests) 222ms
 âœ“ src/config/config.integration.test.ts (18 tests) 1293ms
   âœ“ Configuration Integration Tests > Approval Mode Integration Tests > should parse --approval-mode=auto_edit correctly through the full argument parsing flow  1187ms
 âœ“ src/ui/components/shared/RadioButtonSelect.test.tsx (13 tests) 388ms
 âœ“ src/config/config.test.ts (116 tests | 1 skipped) 448ms
[?2004h[?2004l[?2004h[?2004l[?2004h âœ“ src/ui/hooks/slashCommandProcessor.test.ts (34 tests) 2004ms
]2;Gemini - root]2;Gemini - root[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h âœ“ src/gemini.test.tsx (8 tests) 25ms
[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h âœ“ src/ui/hooks/useAtCompletion.test.ts (13 tests) 1092ms
[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l[?2004h[?2004l âœ“ src/ui/App.test.tsx (49 tests) 1851ms
 âœ“ src/ui/components/SettingsDialog.test.tsx (39 tests) 3782ms
   âœ“ SettingsDialog > String Settings Editing > should allow editing and committing a string setting  570ms
 âœ“ src/ui/commands/ideCommand.test.ts (9 tests) 5034ms
   âœ“ ideCommand > install subcommand > should install the extension  5017ms
 âœ“ src/ui/components/InputPrompt.test.tsx (61 tests) 7055ms

 Test Files  120 passed | 1 skipped (121)
      Tests  1735 passed | 11 skipped (1746)
   Start at  13:28:34
   Duration  17.72s (transform 49.43s, setup 14.84s, collect 364.77s, tests 33.59s, environment 123.14s, prepare 23.74s)

JUNIT report written to /app/packages/cli/junit.xml
 % Coverage report from v8

> @google/gemini-cli-core@0.1.21 test:ci
> vitest run --coverage


 RUN  v3.2.4 /app/packages/core
      Coverage enabled with v8

 âœ“ src/utils/safeJsonStringify.test.ts (8 tests) 11ms
 âœ“ src/utils/editor.test.ts (108 tests) 83ms
 âœ“ src/utils/filesearch/crawlCache.test.ts (9 tests) 22ms
 âœ“ src/utils/ignorePatterns.test.ts (28 tests) 30ms
 âœ“ src/ide/detect-ide.test.ts (22 tests) 13ms
 âœ“ src/utils/partUtils.test.ts (23 tests) 12ms
 âœ“ src/utils/paths.test.ts (55 tests) 26ms
 âœ“ src/utils/errorReporting.test.ts (6 tests) 37ms
 âœ“ src/ide/ideContext.test.ts (16 tests) 26ms
 âœ“ src/utils/environmentContext.test.ts (8 tests) 77ms
 âœ“ src/utils/filesearch/result-cache.test.ts (3 tests) 11ms
 âœ“ src/utils/secure-browser-launcher.test.ts (14 tests) 37ms
 âœ“ src/tools/diffOptions.test.ts (9 tests) 15ms
 âœ“ src/tools/modifiable-tool.test.ts (11 tests) 61ms
 âœ“ src/mcp/oauth-token-storage.test.ts (21 tests) 38ms
 âœ“ src/services/fileSystemService.test.ts (3 tests) 19ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts (36 tests) 22ms
 âœ“ src/mcp/oauth-utils.test.ts (21 tests) 28ms
 âœ“ src/core/turn.test.ts (13 tests) 26ms
 âœ“ src/config/storage.test.ts (5 tests) 8ms
 âœ“ src/ide/process-utils.test.ts (3 tests) 13ms
 âœ“ src/utils/userAccountManager.test.ts (23 tests) 59ms
 âœ“ src/utils/workspaceContext.test.ts (34 tests) 97ms
 âœ“ src/utils/installationManager.test.ts (4 tests) 14ms
 âœ“ src/utils/systemEncoding.test.ts (38 tests) 51ms
 âœ“ src/code_assist/converter.test.ts (21 tests) 20ms
 âœ“ src/services/gitService.test.ts (14 tests) 69ms
 âœ“ src/mcp/oauth-provider.test.ts (19 tests) 188ms
 âœ“ src/utils/memoryImportProcessor.test.ts (23 tests) 74ms
 âœ“ src/core/logger.test.ts (38 tests) 181ms
 âœ“ src/code_assist/server.test.ts (7 tests) 43ms
 âœ“ src/ide/ide-installer.test.ts (10 tests) 24ms
 âœ“ src/services/fileDiscoveryService.test.ts (13 tests) 60ms
 âœ“ src/mcp/google-auth-provider.test.ts (8 tests) 38ms
 âœ“ src/utils/gitIgnoreParser.test.ts (18 tests) 79ms
 âœ“ src/utils/bfsFileSearch.test.ts (11 tests) 115ms
 âœ“ src/code_assist/setup.test.ts (7 tests) 24ms
 âœ“ src/utils/filesearch/ignore.test.ts (12 tests) 35ms
 âœ“ src/index.test.ts (1 test) 7ms
 âœ“ src/services/shellExecutionService.test.ts (30 tests) 136ms
 âœ“ src/ide/ide-client.test.ts (7 tests) 25ms
 âœ“ src/utils/filesearch/crawler.test.ts (18 tests) 86ms
 âœ“ src/tools/tools.test.ts (11 tests) 16ms
 âœ“ src/utils/filesearch/fileSearch.test.ts (27 tests) 154ms
 âœ“ src/telemetry/telemetry-utils.test.ts (6 tests) 9ms
 âœ“ src/tools/mcp-tool.test.ts (33 tests) 106ms
 âœ“ src/core/prompts.test.ts (23 tests) 55ms
 âœ“ src/utils/fileUtils.test.ts (40 tests) 116ms
 âœ“ src/tools/memoryTool.test.ts (19 tests) 153ms
(node:5838) MaxListenersExceededWarning: Possible EventTarget memory leak detected. 11 abort listeners added to [AbortSignal]. MaxListeners is 10. Use events.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
 âœ“ src/tools/grep.test.ts (24 tests) 319ms
 âœ“ src/tools/ripGrep.test.ts (36 tests) 337ms
 âœ“ src/telemetry/sdk.test.ts (4 tests) 39ms
 âœ“ src/utils/errorParsing.test.ts (21 tests) 17ms
 âœ“ src/utils/retry.test.ts (13 tests) 66ms
 âœ“ src/core/contentGenerator.test.ts (8 tests) 18ms
 âœ“ src/code_assist/oauth2.test.ts (14 tests) 91ms
 âœ“ src/telemetry/uiTelemetry.test.ts (19 tests) 95ms
 âœ“ src/tools/read-file.test.ts (25 tests) 293ms
(node:5611) MaxListenersExceededWarning: Possible EventTarget memory leak detected. 11 abort listeners added to [AbortSignal]. MaxListeners is 10. Use events.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
 âœ“ src/tools/shell.test.ts (21 tests) 124ms
 âœ“ src/utils/tool-utils.test.ts (7 tests) 7ms
 âœ“ src/core/coreToolScheduler.test.ts (19 tests) 140ms
 âœ“ src/tools/mcp-client.test.ts (42 tests) 38ms
 âœ“ src/utils/getFolderStructure.test.ts (15 tests) 71ms
 âœ“ src/utils/nextSpeakerChecker.test.ts (10 tests) 65ms
 âœ“ src/utils/editCorrector.test.ts (40 tests) 59ms
 âœ“ src/config/flashFallback.test.ts (6 tests) 10ms
 âœ“ src/utils/summarizer.test.ts (8 tests) 46ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts (6 tests) 62ms
 âœ“ src/tools/tool-registry.test.ts (8 tests) 107ms
 âœ“ src/telemetry/metrics.test.ts (13 tests) 295ms
 âœ“ src/utils/memoryDiscovery.test.ts (14 tests) 115ms
 âœ“ src/utils/shell-utils.test.ts (49 tests) 23ms
 âœ“ src/utils/flashFallback.integration.test.ts (4 tests) 201ms
 âœ“ src/telemetry/loggers.test.ts (16 tests) 73ms
 â¯ src/tools/edit.test.ts (42 tests | 1 failed) 254ms
   âœ“ EditTool > applyReplacement > should return newString if isNewFile is true 5ms
   âœ“ EditTool > applyReplacement > should return newString if currentContent is null and oldString is empty (defensive) 1ms
   âœ“ EditTool > applyReplacement > should return empty string if currentContent is null and oldString is not empty (defensive) 1ms
   âœ“ EditTool > applyReplacement > should replace oldString with newString in currentContent 1ms
   âœ“ EditTool > applyReplacement > should return currentContent if oldString is empty and not a new file 1ms
   âœ“ EditTool > validateToolParams > should return null for valid params 47ms
   âœ“ EditTool > validateToolParams > should return error for relative path 3ms
   âœ“ EditTool > validateToolParams > should return error for path outside root 3ms
   âœ“ EditTool > shouldConfirmExecute > should throw an error if params are invalid 4ms
   âœ“ EditTool > shouldConfirmExecute > should request confirmation for valid edit 8ms
   âœ“ EditTool > shouldConfirmExecute > should return false if old_string is not found (ensureCorrectEdit returns 0) 6ms
   âœ“ EditTool > shouldConfirmExecute > should return false if multiple occurrences of old_string are found (ensureCorrectEdit returns > 1) 4ms
   âœ“ EditTool > shouldConfirmExecute > should request confirmation for creating a new file (empty old_string) 6ms
   âœ“ EditTool > shouldConfirmExecute > should use corrected params from ensureCorrectEdit for diff generation 4ms
   âœ“ EditTool > execute > should throw error if file path is not absolute 4ms
   âœ“ EditTool > execute > should throw error if file path is empty 4ms
   âœ“ EditTool > execute > should edit an existing file and return diff with fileName 6ms
   âœ“ EditTool > execute > should create a new file if old_string is empty and file does not exist, and return created message 4ms
   âœ“ EditTool > execute > should return error if old_string is not found in file 4ms
   âœ“ EditTool > execute > should return error if multiple occurrences of old_string are found 4ms
   âœ“ EditTool > execute > should successfully replace multiple occurrences when expected_replacements specified 5ms
   âœ“ EditTool > execute > should return error if expected_replacements does not match actual occurrences 4ms
   âœ“ EditTool > execute > should return error if trying to create a file that already exists (empty old_string) 4ms
   âœ“ EditTool > execute > should include modification message when proposed content is modified 4ms
   âœ“ EditTool > execute > should not include modification message when proposed content is not modified 5ms
   âœ“ EditTool > execute > should not include modification message when modified_by_user is not provided 5ms
   âœ“ EditTool > execute > should return error if old_string and new_string are identical 5ms
   âœ“ EditTool > execute > should return EDIT_NO_CHANGE error if replacement results in identical content 6ms
   âœ“ EditTool > Error Scenarios > should return FILE_NOT_FOUND error 5ms
   âœ“ EditTool > Error Scenarios > should return ATTEMPT_TO_CREATE_EXISTING_FILE error 5ms
   âœ“ EditTool > Error Scenarios > should return NO_OCCURRENCE_FOUND error 5ms
   âœ“ EditTool > Error Scenarios > should return EXPECTED_OCCURRENCE_MISMATCH error 10ms
   âœ“ EditTool > Error Scenarios > should return NO_CHANGE error 5ms
   âœ“ EditTool > Error Scenarios > should throw INVALID_PARAMETERS error for relative path 4ms
   Ã— EditTool > Error Scenarios > should return FILE_WRITE_FAILURE on write error 25ms
     â†’ expected undefined to be 'file_write_failure' // Object.is equality
   âœ“ EditTool > getDescription > should return "No file changes to..." if old_string and new_string are the same 5ms
   âœ“ EditTool > getDescription > should return a snippet of old and new strings if they are different 4ms
   âœ“ EditTool > getDescription > should handle very short strings correctly in the description 5ms
   âœ“ EditTool > getDescription > should truncate long strings in the description 4ms
   âœ“ EditTool > workspace boundary validation > should validate paths are within workspace root 5ms
   âœ“ EditTool > workspace boundary validation > should reject paths outside workspace root 4ms
   âœ“ EditTool > IDE mode > should call ideClient.openDiff and update params on confirmation 7ms
 âœ“ src/config/config.test.ts (44 tests) 135ms
 âœ“ src/services/loopDetectionService.test.ts (35 tests) 350ms
 âœ“ src/core/client.test.ts (52 tests) 364ms
 âœ“ src/telemetry/clearcut-logger/clearcut-logger.test.ts (21 tests) 194ms
 âœ“ src/tools/web-search.test.ts (9 tests) 118ms
 âœ“ src/services/chatRecordingService.test.ts (10 tests) 33ms
 âœ“ src/tools/ls.test.ts (22 tests) 148ms
 âœ“ src/tools/write-file.test.ts (25 tests) 143ms
 âœ“ src/tools/web-fetch.test.ts (7 tests) 134ms
 âœ“ src/tools/glob.test.ts (34 tests) 1688ms
 âœ“ src/core/subagent.test.ts (19 tests) 188ms
 âœ“ src/telemetry/telemetry.test.ts (2 tests) 23ms
 âœ“ src/tools/mcp-client-manager.test.ts (1 test) 4ms
 âœ“ src/tools/read-many-files.test.ts (31 tests) 419ms
 âœ“ src/core/geminiChat.test.ts (25 tests) 3081ms
   âœ“ GeminiChat > sendMessageStream with retries > should retry on invalid content, succeed, and report metrics  505ms
   âœ“ GeminiChat > sendMessageStream with retries > should fail after all retries on persistent invalid content and report metrics  1504ms
   âœ“ GeminiChat > should correctly retry and append to an existing history mid-conversation  503ms
   âœ“ GeminiChat > should retry if the model returns a completely empty stream (no chunks)  503ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 1 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/tools/edit.test.ts > EditTool > Error Scenarios > should return FILE_WRITE_FAILURE on write error
AssertionError: expected undefined to be 'file_write_failure' // Object.is equality

[32m- Expected:[39m
"file_write_failure"

[31m+ Received:[39m
undefined

 â¯ src/tools/edit.test.ts:761:34
    759|       const invocation = tool.build(params);
    760|       const result = await invocation.execute(new AbortController().siâ€¦
    761|       expect(result.error?.type).toBe(ToolErrorType.FILE_WRITE_FAILUREâ€¦
       |                                  ^
    762|     });
    763|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/1]âŽ¯


 Test Files  1 failed | 89 passed (90)
      Tests  1 failed | 1757 passed (1758)
   Start at  13:28:54
   Duration  7.28s (transform 53.07s, setup 13.82s, collect 206.80s, tests 12.63s, environment 35ms, prepare 17.57s)

JUNIT report written to /app/packages/core/junit.xml
npm error Lifecycle script `test:ci` failed with error:
npm error code 1
npm error path /app/packages/core
npm error workspace @google/gemini-cli-core@0.1.21
npm error location /app/packages/core
npm error command failed
npm error command sh -c vitest run --coverage


> gemini-cli-vscode-ide-companion@0.1.21 test:ci
> vitest run --coverage


 RUN  v3.2.4 /app/packages/vscode-ide-companion
      Coverage enabled with v8

 âœ“ src/open-files-manager.test.ts (17 tests) 46ms
 âœ“ src/ide-server.test.ts (6 tests | 1 skipped) 31ms
 âœ“ src/extension.test.ts (3 tests) 20ms

 Test Files  3 passed (3)
      Tests  25 passed | 1 skipped (26)
   Start at  13:29:02
   Duration  3.63s (transform 1.30s, setup 0ms, collect 5.47s, tests 97ms, environment 1ms, prepare 384ms)

 % Coverage report from v8
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-------------------|---------|----------|---------|---------|-------------------
All files          |   41.41 |       80 |   56.09 |   41.41 |
 ...-ide-companion |       0 |        0 |       0 |       0 |
  esbuild.js       |       0 |        0 |       0 |       0 | 1-63
 ...panion/scripts |       0 |        0 |       0 |       0 |
  ...te-notices.js |       0 |        0 |       0 |       0 | 1-158
 ...-companion/src |   51.11 |    83.33 |   57.89 |   51.11 |
  diff-manager.ts  |   23.38 |       80 |      25 |   23.38 | ...38-239,242-267
  extension.ts     |   48.21 |       50 |   33.33 |   48.21 | ...06-110,115-129
  ide-server.ts    |   50.49 |    88.23 |      80 |   50.49 | ...06-321,332-342
  ...es-manager.ts |   94.32 |    85.29 |     100 |   94.32 | ...85,143-144,151
 ...nion/src/utils |   83.33 |    66.66 |     100 |   83.33 |
  logger.ts        |   83.33 |    66.66 |     100 |   83.33 | 15-16
-------------------|---------|----------|---------|---------|-------------------
